{"files":[{"id":"37811e70-eb23-4470-af10-224fe1fd098c","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Europe/Istanbul\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"96d0355c-66ff-4afb-b860-5b1080ab10a6","name":"Kod","type":"server_js","source":"const SPREADSHEET_ID \u003d \u00271qUpipZJPhH55VItZ4e7_mf-9ioj3w6X_FEkkaOjD3VQ\u0027;\nconst dersTercihTablosu \u003d SpreadsheetApp.openById(SPREADSHEET_ID);\nconst activeSheet \u003d dersTercihTablosu.getSheets()[0];\nconst dersKoduRegExp \u003d /[a-zA-ZıİğĞüÜşŞöÖçÇ]{3}\\d{4}/;\n\nfunction writeToSpreadsheet(itemResponses \u003d []) {\n  const responses \u003d [];\n\n  itemResponses.forEach(itemResponse \u003d\u003e {\n    const response \u003d itemResponse.getResponse();\n\n    if(typeof response \u003d\u003d\u003d \u0027string\u0027) {\n      if(response.trim() \u003d\u003d\u003d \u0027KAYIT\u0027) {\n        responses.push(\u0027X\u0027);\n      } else {\n        responses.push(response);\n      }\n    }\n    if(typeof response \u003d\u003d\u003d \u0027object\u0027 \u0026\u0026 response instanceof Array) {\n      response.forEach(subResponse \u003d\u003e {\n        let dersKoduMatch \u003d subResponse.match(dersKoduRegExp);\n        let dersKodu \u003d dersKoduMatch[0];\n\n        responses.push(dersKodu);\n      });\n    }\n  });\n\n  const responseOkulNumarasi \u003d parseInt(responses[0]);\n  const lastRowNum \u003d activeSheet.getLastRow();\n  const entriesRange \u003d activeSheet.getRange(`A1:A${lastRowNum}`);\n  const entries \u003d entriesRange.getValues().map(entry \u003d\u003e entry[0]);\n  const existingEntryRowIndex \u003d entries.findIndex(okulNumarasi \u003d\u003e okulNumarasi \u003d\u003d\u003d responseOkulNumarasi);\n\n  if(existingEntryRowIndex \u003e -1) {\n    const existingEntryRowNum \u003d existingEntryRowIndex + 1;\n    const existingEntryRange \u003d activeSheet.getRange(`A${existingEntryRowNum}:H${existingEntryRowNum}`);\n    \n    existingEntryRange.setValues([responses]);\n  } else {\n    activeSheet.appendRow(responses);\n  }\n}\n\nfunction formSubmitHandler(event) {\n  const form \u003d event.source;\n  const response \u003d event.response;\n  const itemResponses \u003d response.getItemResponses();\n\n  writeToSpreadsheet(itemResponses);\n}"}]}